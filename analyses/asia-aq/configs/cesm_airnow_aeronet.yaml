# ASIA-AQ CESM/CAM-chem Evaluation Configuration
# Comparing model output with AirNow surface observations and AERONET AOD
#
# Model: CESM/CAM-chem (f.e3b06m.FCnudged.t6s.01x01.01)
# Period: February 1-3, 2024
# Domain: 0-45°N, 90-140°E

analysis:
  start_time: "2024-02-01"
  end_time: "2024-02-03"
  output_dir: output/cesm_evaluation
  debug: false

# Model configuration
model:
  cesm_asiaq:
    mod_type: cesm_fv
    files: /Users/fillmore/Data/ASIA-AQ/f.e3b06m.FCnudged.t6s.01x01.01.cam.h2i.*.nc
    radius_of_influence: 15000  # 15 km for 0.1 deg grid

    # Variable mapping: obs_label -> {model_var: obs_var}
    mapping:
      airnow:
        pm25: PM25
        ozone: O3
        no2: NO2
        co: CO
      aeronet:
        aod_550nm: AODVISdn

    # Model variable configurations with unit conversions
    variables:
      O3:
        unit_scale: 1.0e9  # mol/mol to ppb
        ylabel_plot: "O3 (ppbv)"
        vmin_plot: 0
        vmax_plot: 100
        vdiff_plot: 30
      NO2:
        unit_scale: 1.0e9  # mol/mol to ppb
        ylabel_plot: "NO2 (ppbv)"
        vmin_plot: 0
        vmax_plot: 50
        vdiff_plot: 20
      CO:
        unit_scale: 1.0e9  # mol/mol to ppb
        ylabel_plot: "CO (ppbv)"
        vmin_plot: 0
        vmax_plot: 1000
        vdiff_plot: 200
      PM25:
        unit_scale: 1.2e9  # kg/kg to ug/m3 (× air density × 1e9)
        ylabel_plot: "PM2.5 (μg/m³)"
        vmin_plot: 0
        vmax_plot: 150
        vdiff_plot: 50
      AODVISdn:
        unit_scale: 1.0
        ylabel_plot: "AOD (550 nm)"
        vmin_plot: 0
        vmax_plot: 2.0
        vdiff_plot: 0.5

# Observation configurations
obs:
  airnow:
    obs_type: pt_sfc
    filename: data/airnow_asiaq_2024-02-01_2024-02-03.nc
    variables:
      pm25:
        obs_min: 0
        obs_max: 500
        ylabel_plot: "PM2.5 (μg/m³)"
      ozone:
        obs_min: 0
        obs_max: 200
        ylabel_plot: "O3 (ppbv)"
      no2:
        obs_min: 0
        obs_max: 100
        ylabel_plot: "NO2 (ppbv)"
      co:
        unit_scale: 1000  # ppm to ppb
        obs_min: 0
        obs_max: 5000
        ylabel_plot: "CO (ppbv)"

  aeronet:
    obs_type: pt_sfc
    filename: data/AERONET_L15_20240201_20240203.nc
    variables:
      aod_550nm:
        obs_min: 0
        obs_max: 5.0
        ylabel_plot: "AOD (550 nm)"

# Pairing groups (which model-obs combinations to analyze)
pairs:
  cesm_airnow_pm25:
    model: cesm_asiaq
    obs: airnow
    variable:
      model_var: PM25
      obs_var: pm25

  cesm_airnow_o3:
    model: cesm_asiaq
    obs: airnow
    variable:
      model_var: O3
      obs_var: ozone

  cesm_aeronet_aod:
    model: cesm_asiaq
    obs: aeronet
    variable:
      model_var: AODVISdn
      obs_var: aod_550nm

# Plotting configuration
plots:
  # PM2.5 plots
  pm25_timeseries:
    type: timeseries
    pairs: [cesm_airnow_pm25]
    title: "PM2.5 Time Series - ASIA-AQ"

  pm25_scatter:
    type: scatter
    pairs: [cesm_airnow_pm25]
    title: "PM2.5 Model vs Observations"

  pm25_spatial_bias:
    type: spatial_bias
    pairs: [cesm_airnow_pm25]
    title: "PM2.5 Spatial Bias"

  # Ozone plots
  o3_timeseries:
    type: timeseries
    pairs: [cesm_airnow_o3]
    title: "O3 Time Series - ASIA-AQ"

  o3_scatter:
    type: scatter
    pairs: [cesm_airnow_o3]
    title: "O3 Model vs Observations"

  # AOD plots
  aod_scatter:
    type: scatter
    pairs: [cesm_aeronet_aod]
    title: "AOD Model vs AERONET"

  aod_spatial_bias:
    type: spatial_bias
    pairs: [cesm_aeronet_aod]
    title: "AOD Spatial Bias"

# Statistics configuration
stats:
  output_table: true
  output_table_kwargs:
    precision: 3
  metrics:
    - N         # Number of pairs
    - MO        # Mean observation
    - MP        # Mean prediction
    - MB        # Mean bias
    - RMSE      # Root mean square error
    - R         # Correlation coefficient
    - NMB       # Normalized mean bias (%)
    - NME       # Normalized mean error (%)
    - IOA       # Index of agreement
